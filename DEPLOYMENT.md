# StreamX Beta Deployment Guide

## المتطلبات الأساسية

1. حساب Cloudflare Pages
2. حساب Cloudflare R2 للتخزين
3. حساب Stripe للمدفوعات
4. حساب Sentry لتتبع الأخطاء
5. خادم SMTP للبريد الإلكتروني

## خطوات النشر

### 1. إعداد قاعدة البيانات
- إنشاء قاعدة بيانات D1 في Cloudflare
- الحصول على رابط الاتصال وtoken الخاص بقاعدة البيانات
- تشغيل ملفات الترحيل (migrations)

### 2. إعداد التخزين
- إنشاء bucket في Cloudflare R2
- الحصول على مفاتيح الوصول (Access Keys)
- تكوين سياسات CORS

### 3. إعداد المدفوعات
- إنشاء حساب Stripe
- إعداد المنتجات والأسعار
- تكوين Webhook
- الحصول على مفاتيح API

### 4. إعداد تتبع الأخطاء
- إنشاء مشروع في Sentry
- تكوين DSN
- إعداد التكامل مع Next.js

### 5. إعداد البريد الإلكتروني
- تكوين خادم SMTP
- اختبار إرسال البريد الإلكتروني

### 6. تكوين المتغيرات البيئية
نسخ ملف `.env.example` إلى `.env` وملء القيم التالية:

#### قاعدة البيانات
- DATABASE_URL
- DATABASE_AUTH_TOKEN

#### المصادقة
- JWT_SECRET (يمكن توليده باستخدام `openssl rand -base64 32`)
- NEXTAUTH_SECRET
- NEXTAUTH_URL

#### Cloudflare
- CLOUDFLARE_ACCOUNT_ID
- CLOUDFLARE_API_TOKEN
- CLOUDFLARE_ZONE_ID

#### التخزين
- R2_ACCESS_KEY_ID
- R2_SECRET_ACCESS_KEY
- R2_BUCKET_NAME

#### المدفوعات
- STRIPE_SECRET_KEY
- STRIPE_WEBHOOK_SECRET
- NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY

#### تتبع الأخطاء
- NEXT_PUBLIC_SENTRY_DSN
- SENTRY_AUTH_TOKEN
- SENTRY_PROJECT
- SENTRY_ORG

#### البريد الإلكتروني
- SMTP_HOST
- SMTP_PORT
- SMTP_USER
- SMTP_PASSWORD
- EMAIL_FROM

### 7. النشر على Cloudflare Pages
1. ربط المستودع مع Cloudflare Pages
2. تكوين متغيرات البيئة في إعدادات المشروع
3. تكوين النطاق المخصص (إن وجد)
4. تشغيل عملية النشر

### 8. اختبارات ما قبل الإطلاق
- [  ] التحقق من عمل المصادقة
- [  ] اختبار تحميل الملفات
- [  ] اختبار المدفوعات
- [  ] التحقق من تتبع الأخطاء
- [  ] اختبار إرسال البريد الإلكتروني
- [  ] فحص الأداء
- [  ] اختبار التوافق مع المتصفحات

### 9. المراقبة والتحسين
- إعداد تنبيهات Sentry
- مراقبة أداء التطبيق
- تتبع سلوك المستخدم
- تحسين الأداء حسب الحاجة

## الأمان

1. التأكد من تفعيل HTTPS
2. تكوين سياسات CSP
3. تفعيل التحقق بخطوتين (إن أمكن)
4. تكوين حدود الطلبات Rate Limiting
5. تشفير البيانات الحساسة

## النسخ الاحتياطي

1. إعداد نسخ احتياطي تلقائي لقاعدة البيانات
2. نسخ احتياطي للملفات في R2
3. توثيق إجراءات الاسترداد

## التوثيق

1. توثيق عمليات النشر
2. توثيق إجراءات الصيانة
3. إنشاء دليل المستخدم
4. توثيق API 